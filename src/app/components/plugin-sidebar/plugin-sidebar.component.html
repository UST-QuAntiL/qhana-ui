<div class="sidebar-container">
    <div class="nav-icons" [attr.data-open]="sidebarOpen ? 'yes' : 'no'">
        <button mat-ripple class="sidebar-button {{(activeArea === 'templates') ? 'active' : ''}}"
            matTooltip="Choose Template" matTooltipPosition="after" aria-label="choose template"
            (click)="switchActiveArea('templates')">
            <mat-icon>menu_open</mat-icon>
        </button>
        <button mat-ripple class="sidebar-button {{(activeArea === 'detail') ? 'active' : ''}}"
            matTooltip="Template Details" matTooltipPosition="after" aria-label="template details"
            (click)="switchActiveArea('detail')">
            <mat-icon>info</mat-icon>
        </button>
        <button mat-ripple class="sidebar-button {{(activeArea === 'search') ? 'active' : ''}}" matTooltip="Search"
            matTooltipPosition="after" aria-label="search plugins" (click)="switchActiveArea('search')">
            <mat-icon>search</mat-icon>
        </button>
        <button mat-ripple class="sidebar-button {{(activeArea === 'plugins' && activeGroup == group) ? 'active' : ''}}"
            [matTooltip]="group.name" matTooltipPosition="after" [attr.aria-label]="group.name"
            (click)="switchActiveArea('plugins', group)" *ngFor="let group of pluginGroups">
            <mat-icon>extension</mat-icon>
        </button>
    </div>
    <div class="sidebar-expander color-scheme-card" [attr.data-open]="sidebarOpen ? 'yes' : 'no'">
        <div class="expander-head">
            <details [open]="activeArea === 'templates'">
                <summary class="no-decoration" (click)="toggleTemplateHeader($event)">
                    <h2 class="template-header">
                        {{selectedTemplateName}}
                        <mat-icon matSuffix [hidden]="activeArea === 'templates'">expand_more</mat-icon>
                        <mat-icon matSuffix [hidden]="activeArea !== 'templates'">expand_less</mat-icon>
                    </h2>
                </summary>
                <mat-divider></mat-divider>
                <button mat-button class="w-100 all-plugins-button" (click)="selectTemplate(null)">show all
                    plugins</button>
                <mat-divider></mat-divider>
                <!-- TODO add interaction/selection once templates are fully supported in the registry -->
                <qhana-growing-list [rels]="['ui-template', 'collection']" [newItemRels]="['ui-template']"
                    [highlighted]="highlightedTemplates" [highlightByKey]="'templateId'"
                    (clickItem)="selectTemplate($event)"></qhana-growing-list>
                <mat-divider></mat-divider>
                <button mat-ripple class="sidebar-button w-100" (click)="createTemplate()">Create Template</button>
            </details>
            <mat-form-field class="full-width" color="primary"
                [hidden]="activeArea == 'detail' || activeArea == 'templates'">
                <mat-label>Search plugins</mat-label>
                <input matInput placeholder="search" (focus)="activeArea = 'search'" autocomplete="off" #searchInput>
                <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>
        </div>
        <div [hidden]="activeArea != 'detail'">
            <mat-divider></mat-divider>
            <h3 class="sidebar-header">Template Details</h3>
            <div class="form-field-container">
                Name: {{selectedTemplateName}}
            </div>
            <div class="form-field-container">
                Description: {{selectedTemplateObject?.description}}
                <br>
            </div>
            <!-- <button mat-button (click)="updateTemplate()">Save</button> -->
            <div class="form-field-container" *ngIf="this.selectedTemplate">
                <button mat-raised-button color="primary" (click)="updateTemplate()">Edit</button>
                <button mat-raised-button color="warn" (click)="deleteSelectedTemplate()">Delete</button>
            </div>
            <mat-divider></mat-divider>
            <h3 class="sidebar-header">Template Tabs</h3>
            <div *ngIf="selectedTemplateTabsLink">
                <qhana-growing-list [apiLink]="selectedTemplateTabsLink" [deleteButton]="this.selectedTemplate ? true : false" 
                    (clickItem)="selectTab($event)"></qhana-growing-list>
            </div>
            <div *ngIf="this.selectedTemplate">
                <mat-divider></mat-divider>
                <h3 class="sidebar-header">Create Template Tab</h3>
                <form class="form-field-container" *ngIf="this.selectedTemplate" [formGroup]="createTabForm" (ngSubmit)="createTemplateTab()">
                    <mat-form-field class="w-100" color="primary">
                        <mat-label>Tab Name</mat-label>
                        <input matInput placeholder="Tab Name" formControlName="tabName" autocomplete="off">
                    </mat-form-field>
                    <button mat-raised-button color="primary" type="submit">
                        Add Tab
                        <mat-icon aria-label="Enter Key">keyboard_return</mat-icon>
                    </button>
                </form>
            </div>
            <!-- <button mat-ripple class="sidebar-button w-100" (click)="createTemplateTab()">Create Template Tab</button> -->
        </div>
        <details class="plugin-group" [open]="group.open" *ngFor="let group of pluginGroups"
            [hidden]="activeArea == 'detail' || activeArea == 'templates'">
            <summary class="no-decoration" (click)="togglePluginGroup(group, $event)">
                <mat-divider></mat-divider>
                <h3 class="plugin-group-header">
                    <span class="plugin-group-header-text">
                        <mat-icon>extension</mat-icon>
                        {{group.name}}
                    </span>
                    <mat-icon matSuffix [hidden]="group.open">expand_more</mat-icon>
                    <mat-icon matSuffix [hidden]="!group.open">expand_less</mat-icon>
                </h3>
                <mat-divider></mat-divider>
            </summary>
            <qhana-growing-list [apiLink]="group.link" [query]="group?.query ?? null" [search]="searchInput.value"
                [highlighted]="highlightedPlugins" [highlightByKey]="'pluginId'"
                (clickItem)="selectPlugin($event)"></qhana-growing-list>
            <mat-divider></mat-divider>
        </details>
    </div>
</div>
